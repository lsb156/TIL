
# Session1. Zero Trust (Hashicorp CTO 발표)

## 개요
- 앞에 G/W에 방화벽 보안강화를 집중한다고해도 각 서비스별로 신뢰도는 얼마나 클까? 100%? 80%?
- 유저가 접속하는 방화벽만 막으면 되는줄 알았지만 클라우드 환경으로 변경하면서 내부에 위험요인이 생김
- 내부직원의 파일유출(고의성이 아니더라도 유출) 혹은 퇴사자 or 외부협력업체
- Github에 비밀번호 하드코딩
- Zero Trust! 아무도 믿지말아라
- 유출되어도 상관없는 ID/PW 체계를 만들어라
## Zero Trust의 필요성
- Request가 들어오면 인증이 필요 권한부여가 필요
- 권한을 부여할때 룰을 정한다.
- 룰이 없으면 Default Deny! (과거는 Default Allow)
- 블랙리스트보단 화이트리스트 전략이 더 안전함
    - 실수로 black list 지정을 하지 않으면 헛점발생
- 동일 네트워크 그룹내에서 IP기반의 ACL은 한계가 존재함.
    - 몇천대의 서버의 IP리스트를 일일이 허용해주기엔 너무 한계가 존재.
    - 컨테이너 환경은 IP를 고정할 수 없음
    - 람다같은 경우는 1초마다 없어지고 생김 (이런건 룰 자체를 적용할 수 없음)
    - 룰 자체를 Identity 방식으로 설정이 필요함
## Vault의 장점
- AWS, GCP, AD, K8S 별로 토큰이 다 다를수 밖에 없음
- 각각의 Application에 Policy를 적용
- Key/Value Store
    - 인크립션 어플 인증이 되어야 권한이 생기고 읽을 수 있음
- Vault가 K/V Store로만 알고있지만 Secret Manager의 역할이 훨씬 강력함
- 고정화가 되어있는 시크릿이 아님
- 볼트에 들어가면 UserName, Password가 다름
- Application에서 Vault로 붙어 디비정보를 달라고하면 새로운 권한을 생성해줌
    - 직접 Vault가 DB에 요청하여 권한을 생성
    - create X with Y grant Z 를 실행하여 권한을 생성하고 해당 ID/PW를 요청자에게 전달.
    - 유효기간이 7일이라고한다면 7일 이후 drop Z (기한 이후 자동 삭제)
- K/V store만 하는것이 아닌  Rotation Deletion 을 하는게 진정한 볼트의 가치
## Consul의 장점
- Session Record로 사용
- Service Discovery의 기능이 좋음
- 각 App에게 TLS를 나눠주고 policy를 통해서 통신하도록 설정하여 사용
- A -> B 통신의 권한이 없는경우 rejection을 하게됨
- Consul + Terraform
    - Terraform에 Java App과 DB를 넣어주면 IP정보는 consul에서 진행
    - Terraform에서 코드를 넣으면 단 몇초만에 생태계 구성 가능


# Session2. 클라우드 배포/운영/보안강화 전략 (Hashicorp 코리아 김정훈 전무)
## 배포
### terraform
- IaC도구 (Infrastructure as Code)
- 인프라를 코드화
    - 하나의 장비에 대한 프로비져닝이 아닌 생태계 전체를 코드화하여 관리 가능.
    - 인프라의 표준화 / 재사용성 강화
    - 조직적인 문제를 해결
        - 조직내 인력변동이 생기면 이슈가 생김.
        - 표준화를 통해 이를 방지 가능
    - 하지말아야 할것들을 테라폼에서 가능
        - 규정을 정해놓고 미달시에는 배포를 못하게 하는것도 가능
- 신속하고 안전한 인프라
- 관리 효율성 증가
- 누가 배포를하던 동일한 환경을 제공하고 실수를 미연에 방지할 수 있음
- Packer(hashicorp 제품)를 통해 배포 단위를 만듦 (Image Builder)

## 운영
### Nomad
- 컨테이너 오케스트레이션
    - 여러대의 서버를 이용하여 K8s 처럼 구동이 가능한 환경 구성이 가능.
    - 메모리가 여유있는곳이 있으면 그곳에 적절한 어플리케이션으로 구동
        - 구동된 어플은 랜덤 포트를 가지게되는데 이걸 consul랑 같이 연동하여 편하게 사용가능.
- 어플리케이션 관리
    - 레거시, 어플리케이션 관리 (가상화/베어메탈)
- 배치 워크로드 관리
    - 스케쥴러를 만들고 일정시간마다 돌려주는 기능도 가능
- 고객들의 후기
    - Nomad는 Kubernates보다 훨씬 더 단순
    - 누군가가 쿠버네티스를 사용하기 때문에 막연히 필요하다고 생각하는것은 아닌지?
    - 쿠버네티스만을 관리하는 팀이 따로 필요
    - 오케스트레이션만 원하는 경우 사용하기 용이함

## 클라우드 배포/운영/보안 강화 전략
### Vault
- vault로 할 수 있는것
    - 클라우드 접근키 관리
    - DB크리덴셜 관리
    - 서버 접근 키 관리 SSH OTP
    - 각종 접근키 중앙 저장 KV Store
    - 데이터 암호화 관리
- 퍼블릭 클라우드 접근키 관리
    - 피해사례
        - AWS 접근키 탈취당해 고객정보유출
        - Android, iOS 앱 내 수천개 AWS 크레덴셜이 존재했었음
        - 공통적으로 퍼블릭키가 탈취당한 경우가 많음
    - 접근키 관리의 문제점
        - 패스워드는 항상 개발자의 메모장 혹은 엑셀에 관리
        - 패스워드를 퇴사자/협력업체가 유출
        - 평문으로 소스 코드에 기입하는 경우
- 볼트의 메커니즘
    - 호텔에서 체크인하는 절차와 비슷 (사용자가 AWS에 접근)
    - 리셉션에서 인증 및 카드키 신청 (사용자가 Valut에 인증 : LDAP, Okta)
    - 카드키로 2박3일동안만 사용 가능한 정책 등록 (접근키 생성하여 사용자에게 지급하고 AWS에 하루만 사용하고 접근 가능한 IP를 설정)

- 유저가 Vault에 접근할때 볼트가 실제로 가지고 있는 키를 주는게 아닌 접근시 실제로 접근하는곳에 권한을 생성
    - DB에 접근할때는 실제로 DB에 `create X with Y grant Z` 를 실행하고 유효기간 만료시 `drop X`를 실행
    - 접근권한 생성은 GUI, API, CLI로 가능
    - 앱키가 유출이 되더라도 피해가 크지 않음
- vault의 유용함
    - KISA 정보보호 및 개인정보보호관리체계 인증 심사 ISMS, ISMS-P
        - DB credencial 코드를 변경해야하는데 vault로 해결 가능
        - Terraform에 변경 스크립트를 적용해놓으면 자동화 가능
