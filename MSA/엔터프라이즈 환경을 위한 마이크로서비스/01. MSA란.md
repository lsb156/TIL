# 01. 마이크로 서비스는 무엇인가?
MSA는 **독자적인 프로세스로 실행**되고 **독립적으로 개발** 및 배포되는 작고 독립적인 서비스의 모음

MSA의 각 서비스는 독립적으로 디자인, 개발, 배치, 관리되는 잘 정의된 비즈니스 기능을 제공

## 비즈니스 기능 지향
특정 서비스가 특정 비즈니스 목적을 충족하고 잘 정의된 책임을 가지도록 서비스가 비즈니스 기능을 기반으로 디자인 되어야함 

주어진 서비스는 오직 한 가지 일에만 집중하고 이를 수행

모놀리틱 서비스처럼 너무 큰 덩어리의 서비스도 안좋긴 하지만 오히려 너무 작은 서비스도 안티패턴으로 간주됨

서비스는 콘웨이의 법칙을 따르기 때문에 신중하게 잘 나누어야 하는것이 중요

> **콘웨이 법칙**
> 
> 멜빈 콘웨이(Melvin Conway)가 제안한 법칙으로 시스템 구조는 설계하는 조직의 커뮤니케이션 구조와 닮는다는 내용

## 자율성, 개발 배포 확장의 독립성
모놀리틱 어플리케이션과 달리 서비스가 동일한 실행 런타임을 공유하지 않아 서로 격리된 런타임으로 배포.

서로 격리되어 운영이 되어 더 많은 트래픽이 나오는 서비스만 확장이 가능

자율적인 서비스는 서비스 분리를 통해 장애를 격리함으로써 전체 시스템의 탄력성을 보장

## 중앙 ESB 부재: 스마트 앤드포인트와 멍청한 파이프
기존 SOA 기반 아키텍쳐는 ESB에 모든것들이 집중되어 있어서 복잡성이 증가되었지만
MSA에서는 이를 각 서비스에 분산을 시키게 되어 다음과 같은 어려운 기능들을 직접 구현해야 한다.

- 다른 통신 프로토콜을 통한 서비스간 통신
- 회로 차단기 같은 복원력 패턴 적용
- SaaS
- API
- 데이터 및 독점 시스템 등 다른 어플리케이션과의 통합
- 통합 서비스에 대한 관찰 기능

## 실패 내결함성 (fault tolerance)
MSA는 서비스간 각 네트워크의 확산으로 실ㅎ패에 좀 더 취약함
각 서비스간 통신중 하나 이상의 서비스가 실패할 떄 그 실패가 확산이 되어서는 안된다.

그래서 서비스 개발 초기에 디자인, 개발, 배포 단계에서 실패를 감내해야 하는 서비스로 디자인해야함.

실패를 감내하는 탄력성을 갖게하려면 다음과 같은 처리를 해야한다. 
- Circuit Breaker
- load-balancing
- fail-over
- 동적 확장

넷플릭스의 카오스몽키와 같은 도구를 사용하여 서비스 개발 및 테스트 과정 일부로 발생 가능한 오류를 재현하는것이 매우 중요하다.

프로덕션 환경에서는 서비스의 오류감지 및 예측을 해야하고 그런 서비스를 복원해야하는것이 중요하다.

모니터링, 추적, 로깅 등을 사용하여 장애의 증상을 분석할 수 있어야 한다.

## 분산화된 데이터 관리
MSA는 동일한 중앙 집중식 데이터베이스를 사용하면 독립적이지 않은 상황임
(하나의 스키마 변경으로 다른곳에도 장애가 발생할 수 있음.)

각 MSA는 전용 데이터 베이스를 갖을 수 있고 해당 서비스의 성격에 맞는 데이터 베이스 선택이 가능하다.

## 서비스 거버넌스
SOA 거버넌스는 조직 내의 다른 엔티티 간의 협력과 조정을 제공

> **거버넌스** (governance)
> 
> 거버넌스는 일반적으로 ‘과거의 일방적인 정부 주도적 경향에서 벗어나 정부, 기업, 비정부기구 등 다양한 행위자가 공동의 관심사에 대한 네트워크를 구축하여 문제를 해결하는 새로운 국정운영의 방식’

MSA 거버넌스는 각 서비스 소유자가 자신으 ㅣ서비스를 디자인, 개발, 실행할 수 있도록 자유를 부여 받는 분산된 프로세스

단일 기술들로 표준화 하기 보다는 각 서비스에 적합한 작업 도구들을 사용할 수 있다.

SOA에서의 거버넌스는 다음과 같이 정리된다.

- SOA 
  - 디자인 시점 거버넌스
    - 기술
    - 프로토콜
  - 런타임 거버넌스
    - 서비스 정의
    - 서비스 레지스트리 및 검색
    - 서비스 버전 관리
    - 서비스 런타임 종속성
    - 서비스 소유권 및 서비스 소비자
    - QoS 적용
    - 서비스 관찰 가능성
    
MSA에서 런타임 거버넌스는 매우 중요한 개념 
(MSA 컨텍스트에서는 런타임 거버넌스라고 말하지 않음.)

보안과 같은 서비스 품질(QoS) 적용을 위해 중앙 집중식으로 강제하려면 API 게이트웨이와 같은곳에서 수행해야 한다.
MSA는 런타임 거버넌스 측면의 일부는 API 게이트웨이 계층에서 구현됨

## 관찰 가능성
관찰가능성 (Service Observability)는 모니터링, 분산 로깅, 분산 추적, 서비스 런타임 동작 및 종속성 시각화의 조합으로 런타임 거버넌스의 일부로 간주 될 수 있음.
